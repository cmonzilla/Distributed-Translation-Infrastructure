\hypertarget{classasio_1_1coroutine}{}\section{asio\+:\+:coroutine Class Reference}
\label{classasio_1_1coroutine}\index{asio\+::coroutine@{asio\+::coroutine}}


Provides support for implementing stackless coroutines.  




{\ttfamily \#include $<$asio/coroutine.\+hpp$>$}

\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classasio_1_1coroutine_aae689a0aee08699c9d68bdc9d246b5cb}{coroutine} ()
\begin{DoxyCompactList}\small\item\em Constructs a coroutine in its initial state. \end{DoxyCompactList}\item 
bool \hyperlink{classasio_1_1coroutine_ab7693e381b3fc429bc12393c73f507a3}{is\+\_\+child} () const 
\begin{DoxyCompactList}\small\item\em Returns true if the coroutine is the child of a fork. \end{DoxyCompactList}\item 
bool \hyperlink{classasio_1_1coroutine_ab5ed275eee663bca6638668ff27dd40d}{is\+\_\+parent} () const 
\begin{DoxyCompactList}\small\item\em Returns true if the coroutine is the parent of a fork. \end{DoxyCompactList}\item 
bool \hyperlink{classasio_1_1coroutine_a31134bbc275316e9bea1e08df9021a68}{is\+\_\+complete} () const 
\begin{DoxyCompactList}\small\item\em Returns true if the coroutine has reached its terminal state. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Friends}
\begin{DoxyCompactItemize}
\item 
class \hyperlink{classasio_1_1coroutine_a481da3cf2fa1764180915143c632eb2e}{detail\+::coroutine\+\_\+ref}
\end{DoxyCompactItemize}


\subsection{Detailed Description}
Provides support for implementing stackless coroutines. 

The {\ttfamily coroutine} class may be used to implement stackless coroutines. The class itself is used to store the current state of the coroutine.

Coroutines are copy-\/constructible and assignable, and the space overhead is a single int. They can be used as a base class\+:


\begin{DoxyCode}
 \textcolor{keyword}{class }session : \hyperlink{classasio_1_1coroutine_aae689a0aee08699c9d68bdc9d246b5cb}{coroutine}
\{
  ...
\}; 
\end{DoxyCode}


or as a data member\+:


\begin{DoxyCode}
 \textcolor{keyword}{class }session
\{
  ...
  \hyperlink{classasio_1_1coroutine_aae689a0aee08699c9d68bdc9d246b5cb}{coroutine} coro\_;
\}; 
\end{DoxyCode}


or even bound in as a function argument using lambdas or {\ttfamily \hyperlink{namespaceasio_1_1detail_1_1socket__ops_a86014a1273549d66157c6e4dd9532f86}{bind()}}. The important thing is that as the application maintains a copy of the object for as long as the coroutine must be kept alive.

\begin{DoxyParagraph}{Pseudo-\/keywords}

\end{DoxyParagraph}
A coroutine is used in conjunction with certain \char`\"{}pseudo-\/keywords\char`\"{}, which are implemented as macros. These macros are defined by a header file\+:


\begin{DoxyCode}
\textcolor{preprocessor}{#include <\hyperlink{yield_8hpp}{asio/yield.hpp}>}
\end{DoxyCode}


and may conversely be undefined as follows\+:


\begin{DoxyCode}
\textcolor{preprocessor}{#include <\hyperlink{unyield_8hpp}{asio/unyield.hpp}>}
\end{DoxyCode}


{\bfseries reenter}

The {\ttfamily reenter} macro is used to define the body of a coroutine. It takes a single argument\+: a pointer or reference to a coroutine object. For example, if the base class is a coroutine object you may write\+:


\begin{DoxyCode}
 \hyperlink{yield_8hpp_a845826f234aec2b016cac4e60aff9bb5}{reenter} (\textcolor{keyword}{this})
\{
  ... \hyperlink{classasio_1_1coroutine_aae689a0aee08699c9d68bdc9d246b5cb}{coroutine} body ...
\} 
\end{DoxyCode}


and if a data member or other variable you can write\+:


\begin{DoxyCode}
 \hyperlink{yield_8hpp_a845826f234aec2b016cac4e60aff9bb5}{reenter} (coro\_)
\{
  ... \hyperlink{classasio_1_1coroutine_aae689a0aee08699c9d68bdc9d246b5cb}{coroutine} body ...
\} 
\end{DoxyCode}


When {\ttfamily reenter} is executed at runtime, control jumps to the location of the last {\ttfamily yield} or {\ttfamily fork}.

The coroutine body may also be a single statement, such as\+:


\begin{DoxyCode}
 \hyperlink{yield_8hpp_a845826f234aec2b016cac4e60aff9bb5}{reenter} (\textcolor{keyword}{this}) for (;;)
\{
  ...
\} 
\end{DoxyCode}


{\bfseries Limitation\+:} The {\ttfamily reenter} macro is implemented using a switch. This means that you must take care when using local variables within the coroutine body. The local variable is not allowed in a position where reentering the coroutine could bypass the variable definition.

{\bfseries yield {\itshape statement}}

This form of the {\ttfamily yield} keyword is often used with asynchronous operations\+:


\begin{DoxyCode}
yield socket\_->async\_read\_some(\hyperlink{group__buffer_ga1ed66e401559cbfd19595392f653b47c}{buffer}(*buffer\_), *\textcolor{keyword}{this}); 
\end{DoxyCode}


This divides into four logical steps\+:

\begin{DoxyItemize}
\item {\ttfamily yield} saves the current state of the coroutine. \item The statement initiates the asynchronous operation. \item The resume point is defined immediately following the statement. \item Control is transferred to the end of the coroutine body.\end{DoxyItemize}
When the asynchronous operation completes, the function object is invoked and {\ttfamily reenter} causes control to transfer to the resume point. It is important to remember to carry the coroutine state forward with the asynchronous operation. In the above snippet, the current class is a function object object with a coroutine object as base class or data member.

The statement may also be a compound statement, and this permits us to define local variables with limited scope\+:


\begin{DoxyCode}
 yield
\{
  mutable\_buffers\_1 b = \hyperlink{group__buffer_ga1ed66e401559cbfd19595392f653b47c}{buffer}(*buffer\_);
  socket\_->async\_read\_some(b, *\textcolor{keyword}{this});
\} 
\end{DoxyCode}


{\bfseries yield return {\itshape expression} ;}

This form of {\ttfamily yield} is often used in generators or coroutine-\/based parsers. For example, the function object\+:


\begin{DoxyCode}
 \textcolor{keyword}{struct }interleave : \hyperlink{classasio_1_1coroutine_aae689a0aee08699c9d68bdc9d246b5cb}{coroutine}
\{
  istream& is1;
  istream& is2;
  \textcolor{keywordtype}{char} operator()(\textcolor{keywordtype}{char} c)
  \{
    \hyperlink{yield_8hpp_a845826f234aec2b016cac4e60aff9bb5}{reenter} (\textcolor{keyword}{this}) for (;;)
    \{
      yield \textcolor{keywordflow}{return} is1.get();
      yield \textcolor{keywordflow}{return} is2.get();
    \}
  \}
\}; 
\end{DoxyCode}


defines a trivial coroutine that interleaves the characters from two input streams.

This type of {\ttfamily yield} divides into three logical steps\+:

\begin{DoxyItemize}
\item {\ttfamily yield} saves the current state of the coroutine. \item The resume point is defined immediately following the semicolon. \item The value of the expression is returned from the function.\end{DoxyItemize}
{\bfseries yield ;}

This form of {\ttfamily yield} is equivalent to the following steps\+:

\begin{DoxyItemize}
\item {\ttfamily yield} saves the current state of the coroutine. \item The resume point is defined immediately following the semicolon. \item Control is transferred to the end of the coroutine body.\end{DoxyItemize}
This form might be applied when coroutines are used for cooperative threading and scheduling is explicitly managed. For example\+:


\begin{DoxyCode}
 \textcolor{keyword}{struct }task : \hyperlink{classasio_1_1coroutine_aae689a0aee08699c9d68bdc9d246b5cb}{coroutine}
\{
  ...
  \textcolor{keywordtype}{void} operator()()
  \{
    \hyperlink{yield_8hpp_a845826f234aec2b016cac4e60aff9bb5}{reenter} (\textcolor{keyword}{this})
    \{
      \textcolor{keywordflow}{while} (... not finished ...)
      \{
        ... \textcolor{keywordflow}{do} something ...
        \hyperlink{yield_8hpp_abaa9287233697b1cd0175180304c7e1d}{yield};
        ... \textcolor{keywordflow}{do} some more ...
        \hyperlink{yield_8hpp_abaa9287233697b1cd0175180304c7e1d}{yield};
      \}
    \}
  \}
  ...
\};
...
task t1, t2;
\textcolor{keywordflow}{for} (;;)
\{
  t1();
  t2();
\} 
\end{DoxyCode}


{\bfseries yield break ;}

The final form of {\ttfamily yield} is used to explicitly terminate the coroutine. This form is comprised of two steps\+:

\begin{DoxyItemize}
\item {\ttfamily yield} sets the coroutine state to indicate termination. \item Control is transferred to the end of the coroutine body.\end{DoxyItemize}
Once terminated, calls to \hyperlink{classasio_1_1coroutine_a31134bbc275316e9bea1e08df9021a68}{is\+\_\+complete()} return true and the coroutine cannot be reentered.

Note that a coroutine may also be implicitly terminated if the coroutine body is exited without a yield, e.\+g. by return, throw or by running to the end of the body.

{\bfseries fork {\itshape statement}}

The {\ttfamily fork} pseudo-\/keyword is used when \char`\"{}forking\char`\"{} a coroutine, i.\+e. splitting it into two (or more) copies. One use of {\ttfamily fork} is in a server, where a new coroutine is created to handle each client connection\+:


\begin{DoxyCode}
 \hyperlink{yield_8hpp_a845826f234aec2b016cac4e60aff9bb5}{reenter} (\textcolor{keyword}{this})
\{
  \textcolor{keywordflow}{do}
  \{
    socket\_.reset(\textcolor{keyword}{new} \hyperlink{namespacewebsocketpp_1_1transport_1_1asio_1_1socket_1_1error_a828ddaa5ed63a761e1b557465a35f05aa0c31b356014843e1d09514e794a539a7}{tcp::socket}(io\_service\_));
    yield acceptor->async\_accept(*socket\_, *\textcolor{keyword}{this});
    \hyperlink{yield_8hpp_ab2e49d0b8dbb3181c7d1f622fd5ea1b4}{fork} server(*\textcolor{keyword}{this})();
  \} \textcolor{keywordflow}{while} (\hyperlink{classasio_1_1coroutine_ab5ed275eee663bca6638668ff27dd40d}{is\_parent}());
  ... client-specific handling follows ...
\} 
\end{DoxyCode}


The logical steps involved in a {\ttfamily fork} are\+:

\begin{DoxyItemize}
\item {\ttfamily fork} saves the current state of the coroutine. \item The statement creates a copy of the coroutine and either executes it immediately or schedules it for later execution. \item The resume point is defined immediately following the semicolon. \item For the \char`\"{}parent\char`\"{}, control immediately continues from the next line.\end{DoxyItemize}
The functions \hyperlink{classasio_1_1coroutine_ab5ed275eee663bca6638668ff27dd40d}{is\+\_\+parent()} and \hyperlink{classasio_1_1coroutine_ab7693e381b3fc429bc12393c73f507a3}{is\+\_\+child()} can be used to differentiate between parent and child. You would use these functions to alter subsequent control flow.

Note that {\ttfamily fork} doesn\textquotesingle{}t do the actual forking by itself. It is the application\textquotesingle{}s responsibility to create a clone of the coroutine and call it. The clone can be called immediately, as above, or scheduled for delayed execution using something like \hyperlink{classasio_1_1io__service_ae01f809800017295e39786f5bca6652e}{io\+\_\+service\+::post()}.

\begin{DoxyParagraph}{Alternate macro names}

\end{DoxyParagraph}
If preferred, an application can use macro names that follow a more typical naming convention, rather than the pseudo-\/keywords. These are\+:

\begin{DoxyItemize}
\item {\ttfamily A\+S\+I\+O\+\_\+\+C\+O\+R\+O\+\_\+\+R\+E\+E\+N\+T\+E\+R} instead of {\ttfamily reenter} \item {\ttfamily A\+S\+I\+O\+\_\+\+C\+O\+R\+O\+\_\+\+Y\+I\+E\+L\+D} instead of {\ttfamily yield} \item {\ttfamily A\+S\+I\+O\+\_\+\+C\+O\+R\+O\+\_\+\+F\+O\+R\+K} instead of {\ttfamily fork} \end{DoxyItemize}


Definition at line 241 of file coroutine.\+hpp.



\subsection{Constructor \& Destructor Documentation}
\hypertarget{classasio_1_1coroutine_aae689a0aee08699c9d68bdc9d246b5cb}{}\index{asio\+::coroutine@{asio\+::coroutine}!coroutine@{coroutine}}
\index{coroutine@{coroutine}!asio\+::coroutine@{asio\+::coroutine}}
\subsubsection[{coroutine()}]{\setlength{\rightskip}{0pt plus 5cm}asio\+::coroutine\+::coroutine (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [inline]}}\label{classasio_1_1coroutine_aae689a0aee08699c9d68bdc9d246b5cb}


Constructs a coroutine in its initial state. 



Definition at line 245 of file coroutine.\+hpp.



\subsection{Member Function Documentation}
\hypertarget{classasio_1_1coroutine_ab7693e381b3fc429bc12393c73f507a3}{}\index{asio\+::coroutine@{asio\+::coroutine}!is\+\_\+child@{is\+\_\+child}}
\index{is\+\_\+child@{is\+\_\+child}!asio\+::coroutine@{asio\+::coroutine}}
\subsubsection[{is\+\_\+child() const }]{\setlength{\rightskip}{0pt plus 5cm}bool asio\+::coroutine\+::is\+\_\+child (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
) const\hspace{0.3cm}{\ttfamily [inline]}}\label{classasio_1_1coroutine_ab7693e381b3fc429bc12393c73f507a3}


Returns true if the coroutine is the child of a fork. 



Definition at line 248 of file coroutine.\+hpp.

\hypertarget{classasio_1_1coroutine_a31134bbc275316e9bea1e08df9021a68}{}\index{asio\+::coroutine@{asio\+::coroutine}!is\+\_\+complete@{is\+\_\+complete}}
\index{is\+\_\+complete@{is\+\_\+complete}!asio\+::coroutine@{asio\+::coroutine}}
\subsubsection[{is\+\_\+complete() const }]{\setlength{\rightskip}{0pt plus 5cm}bool asio\+::coroutine\+::is\+\_\+complete (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
) const\hspace{0.3cm}{\ttfamily [inline]}}\label{classasio_1_1coroutine_a31134bbc275316e9bea1e08df9021a68}


Returns true if the coroutine has reached its terminal state. 



Definition at line 254 of file coroutine.\+hpp.

\hypertarget{classasio_1_1coroutine_ab5ed275eee663bca6638668ff27dd40d}{}\index{asio\+::coroutine@{asio\+::coroutine}!is\+\_\+parent@{is\+\_\+parent}}
\index{is\+\_\+parent@{is\+\_\+parent}!asio\+::coroutine@{asio\+::coroutine}}
\subsubsection[{is\+\_\+parent() const }]{\setlength{\rightskip}{0pt plus 5cm}bool asio\+::coroutine\+::is\+\_\+parent (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
) const\hspace{0.3cm}{\ttfamily [inline]}}\label{classasio_1_1coroutine_ab5ed275eee663bca6638668ff27dd40d}


Returns true if the coroutine is the parent of a fork. 



Definition at line 251 of file coroutine.\+hpp.



\subsection{Friends And Related Function Documentation}
\hypertarget{classasio_1_1coroutine_a481da3cf2fa1764180915143c632eb2e}{}\index{asio\+::coroutine@{asio\+::coroutine}!detail\+::coroutine\+\_\+ref@{detail\+::coroutine\+\_\+ref}}
\index{detail\+::coroutine\+\_\+ref@{detail\+::coroutine\+\_\+ref}!asio\+::coroutine@{asio\+::coroutine}}
\subsubsection[{detail\+::coroutine\+\_\+ref}]{\setlength{\rightskip}{0pt plus 5cm}friend class {\bf detail\+::coroutine\+\_\+ref}\hspace{0.3cm}{\ttfamily [friend]}}\label{classasio_1_1coroutine_a481da3cf2fa1764180915143c632eb2e}


Definition at line 257 of file coroutine.\+hpp.



The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
ext/asio/\hyperlink{coroutine_8hpp}{coroutine.\+hpp}\end{DoxyCompactItemize}
